# Quick Start Guide

Get your Cupperly application running in 5 minutes!

## üöÄ Local Development (Localhost)

### Prerequisites

- Node.js 18+ installed
- PostgreSQL running on localhost:5432
- Git repository cloned

### Step 1: Install Dependencies

```bash
# From the root directory
npm install

# Install backend dependencies
cd apps/api
npm install

# Install frontend dependencies
cd ../web
npm install

# Go back to root
cd ../..
```

### Step 2: Set Up Database

```bash
# Make sure PostgreSQL is running
# Create database (if not exists)
createdb cupperly

# Run migrations
cd packages/database
npx prisma migrate dev
npx prisma db seed

# Go back to root
cd ../..
```

### Step 3: Configure Environment

The `.env` file is already configured for local development:
- Backend API: `http://localhost:3001`
- Frontend Web: `http://localhost:3000`

**No changes needed!** ‚úÖ

### Step 4: Start the Application

Open **two terminal windows**:

**Terminal 1 - Backend:**
```bash
cd apps/api
npm run dev
```

You should see:
```
üöÄ Cupperly API server running on port 3001
üìä Environment: development
üîó Health check: http://localhost:3001/api/health
```

**Terminal 2 - Frontend:**
```bash
cd apps/web
npm run dev
```

You should see:
```
‚ñ≤ Next.js 14.x.x
- Local:        http://localhost:3000
- Ready in X.Xs
```

### Step 5: Test the Application

1. Open browser: `http://localhost:3000`
2. You should see the Cupperly login page
3. Login with demo credentials:
   - Email: `admin@demo.com`
   - Password: `demo123`
4. You should be redirected to the dashboard

**‚úÖ Local development is working!**

---

## üåê Production Deployment (Coolify)

### Prerequisites

- Coolify instance running
- Two domains configured:
  - `demo.cupperly.com` ‚Üí Frontend
  - `api.cupperly.com` ‚Üí Backend
- DNS records pointing to Coolify server

### Step 1: Generate Secrets

```bash
# Generate secure secrets for production
node scripts/generate-secrets.js
```

**Save the output** - you'll need these values for Coolify!

### Step 2: Set Up Database in Coolify

1. Go to Coolify Dashboard
2. Create a new **PostgreSQL** service
3. Note the connection details:
   - Host: (internal hostname, e.g., `postgres`)
   - Port: `5432`
   - Database: `cupperly`
   - User: `postgres`
   - Password: (generated by Coolify)

### Step 3: Create Backend Service

1. In Coolify, create a new **Application**
2. Connect to your Git repository
3. Configure:
   - **Name**: `cupperly-api`
   - **Domain**: `api.cupperly.com`
   - **Port**: `3001`
   - **Build Command**: `cd apps/api && npm install && npm run build`
   - **Start Command**: `cd apps/api && npm start`

4. Add Environment Variables (copy from `.env.production.coolify`):

```env
NODE_ENV=production
PORT=3001
DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@postgres:5432/cupperly
REDIS_URL=redis://redis:6379
JWT_SECRET=<from generate-secrets.js>
JWT_REFRESH_SECRET=<from generate-secrets.js>
NEXTAUTH_SECRET=<from generate-secrets.js>
API_URL=https://api.cupperly.com
WEB_URL=https://demo.cupperly.com
DEFAULT_TENANT=demo
TENANT_SUBDOMAIN_ENABLED=false
BCRYPT_ROUNDS=12
LOG_LEVEL=info
```

5. Deploy the service

### Step 4: Create Frontend Service

1. In Coolify, create another **Application**
2. Connect to the **same** Git repository
3. Configure:
   - **Name**: `cupperly-web`
   - **Domain**: `demo.cupperly.com`
   - **Port**: `3000`
   - **Build Command**: `cd apps/web && npm install && npm run build`
   - **Start Command**: `cd apps/web && npm start`

4. Add Environment Variables:

```env
NODE_ENV=production
WEB_PORT=3000
NEXT_PUBLIC_API_URL=https://api.cupperly.com
API_URL=https://api.cupperly.com
NEXTAUTH_URL=https://demo.cupperly.com
NEXTAUTH_SECRET=<SAME as backend>
JWT_SECRET=<SAME as backend>
JWT_REFRESH_SECRET=<SAME as backend>
```

**‚ö†Ô∏è IMPORTANT**: Use the **SAME** secrets for both services!

5. Deploy the service

### Step 5: Run Database Migrations

After backend is deployed:

1. Go to Coolify ‚Üí Backend Service ‚Üí Terminal
2. Run:
```bash
cd apps/api
npx prisma migrate deploy
npx prisma db seed
```

### Step 6: Test Production Deployment

1. Open `https://demo.cupperly.com`
2. Open browser DevTools (F12) ‚Üí Network tab
3. Try to login with:
   - Email: `admin@demo.com`
   - Password: `demo123`
4. Check Network tab - requests should go to `https://api.cupperly.com`
5. If login works, you're done! üéâ

---

## üîç Troubleshooting

### Local Development Issues

#### Issue: "Port 3001 already in use"

**Solution**:
```bash
# Find and kill the process
# Windows:
netstat -ano | findstr :3001
taskkill /PID <PID> /F

# Mac/Linux:
lsof -ti:3001 | xargs kill -9
```

#### Issue: "Database connection failed"

**Solution**:
```bash
# Check PostgreSQL is running
# Windows:
services.msc  # Look for PostgreSQL service

# Mac:
brew services list

# Linux:
sudo systemctl status postgresql

# Verify connection string in .env
DATABASE_URL="postgresql://postgres:password@localhost:5432/cupperly"
```

#### Issue: "Cannot find module '@cupperly/database'"

**Solution**:
```bash
# Rebuild packages
npm install
cd packages/database
npm run build
cd ../..
```

### Production Issues

#### Issue: CORS errors in browser

**Check**:
1. Backend has `WEB_URL=https://demo.cupperly.com`
2. Frontend has `NEXT_PUBLIC_API_URL=https://api.cupperly.com`
3. Both services are running
4. Restart both services after changing env vars

#### Issue: 502 Bad Gateway

**Check**:
1. Service is running in Coolify
2. Build completed successfully
3. Port is correct (3000 for web, 3001 for API)
4. Check service logs for errors

#### Issue: Authentication not working

**Check**:
1. JWT secrets are **identical** in both services
2. `NEXTAUTH_SECRET` is set in both services
3. `NEXTAUTH_URL` matches frontend domain
4. Clear browser cookies and try again

#### Issue: API requests failing

**Check**:
1. API service is running: `curl https://api.cupperly.com/api/health`
2. Frontend has correct API URL: `NEXT_PUBLIC_API_URL=https://api.cupperly.com`
3. Check browser console for actual error messages
4. Check API service logs in Coolify

---

## üìö Additional Resources

- **Full Setup Guide**: See `ENVIRONMENT_SETUP.md`
- **Deployment Checklist**: See `COOLIFY_SETUP_CHECKLIST.md`
- **Architecture Overview**: See `ARCHITECTURE.md`
- **Environment Variables**: See `.env.production.coolify`

---

## üéØ Quick Commands Reference

### Local Development

```bash
# Start backend
cd apps/api && npm run dev

# Start frontend
cd apps/web && npm run dev

# Run database migrations
cd packages/database && npx prisma migrate dev

# Seed database
cd packages/database && npx prisma db seed

# Generate Prisma client
cd packages/database && npx prisma generate

# View database
cd packages/database && npx prisma studio
```

### Production Testing

```bash
# Test API health
curl https://api.cupperly.com/api/health

# Test frontend
curl https://demo.cupperly.com

# Test login API
curl -X POST https://api.cupperly.com/api/auth/login \
  -H "Content-Type: application/json" \
  -H "X-Tenant-ID: demo" \
  -d '{"email":"admin@demo.com","password":"demo123"}'
```

---

## ‚úÖ Success Checklist

### Local Development
- [ ] Backend running on `http://localhost:3001`
- [ ] Frontend running on `http://localhost:3000`
- [ ] Can login with demo credentials
- [ ] Can view dashboard
- [ ] Can create samples
- [ ] Can create sessions

### Production
- [ ] Backend deployed to `https://api.cupperly.com`
- [ ] Frontend deployed to `https://demo.cupperly.com`
- [ ] Health check works: `https://api.cupperly.com/api/health`
- [ ] Website loads without errors
- [ ] No CORS errors in browser console
- [ ] Can login successfully
- [ ] All features work as expected

---

## üÜò Need Help?

1. Check the troubleshooting section above
2. Review `COOLIFY_SETUP_CHECKLIST.md` for detailed steps
3. Check Coolify service logs for errors
4. Verify all environment variables are set correctly
5. Ensure both services are running

---

**You're all set! Happy cupping! ‚òï**

